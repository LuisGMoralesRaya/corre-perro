{% schema %}
{
  "name": "Dog Size Quiz",
  "tag": "section",
  "class": "dog-size-quiz-section",
  "limit": 1,
  "max_blocks": 30,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "TÃ­tulo del Quiz",
      "default": "Encuentra la talla perfecta para tu perro"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Color Principal",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Color Secundario",
      "default": "#f8f8f8"
    }
  ],
  "blocks": [
    {
      "type": "dog_breed",
      "name": "Raza de Perro",
      "settings": [
        {
          "type": "image_picker",
          "id": "breed_image",
          "label": "Imagen de la Raza"
        },
        {
          "type": "text",
          "id": "breed_name",
          "label": "Nombre de la Raza"
        },
        {
          "type": "header",
          "content": "Rango 1"
        },
        {
          "type": "text",
          "id": "weight_range_1",
          "label": "Rango de Peso (ej: 18-22)",
          "info": "Formato: min-max"
        },
        {
          "type": "text",
          "id": "neck_range_1",
          "label": "Rango de Cuello (ej: 36-40)",
          "info": "Formato: min-max"
        },
        {
          "type": "text",
          "id": "size_1",
          "label": "Talla"
        },
        {
          "type": "header",
          "content": "Rango 2"
        },
        {
          "type": "text",
          "id": "weight_range_2",
          "label": "Rango de Peso"
        },
        {
          "type": "text",
          "id": "neck_range_2",
          "label": "Rango de Cuello"
        },
        {
          "type": "text",
          "id": "size_2",
          "label": "Talla"
        },
        {
          "type": "header",
          "content": "Rango 3"
        },
        {
          "type": "text",
          "id": "weight_range_3",
          "label": "Rango de Peso"
        },
        {
          "type": "text",
          "id": "neck_range_3",
          "label": "Rango de Cuello"
        },
        {
          "type": "text",
          "id": "size_3",
          "label": "Talla"
        },
        {
          "type": "header",
          "content": "Rango 4"
        },
        {
          "type": "text",
          "id": "weight_range_4",
          "label": "Rango de Peso"
        },
        {
          "type": "text",
          "id": "neck_range_4",
          "label": "Rango de Cuello"
        },
        {
          "type": "text",
          "id": "size_4",
          "label": "Talla"
        },
        {
          "type": "header",
          "content": "Rango 5"
        },
        {
          "type": "text",
          "id": "weight_range_5",
          "label": "Rango de Peso"
        },
        {
          "type": "text",
          "id": "neck_range_5",
          "label": "Rango de Cuello"
        },
        {
          "type": "text",
          "id": "size_5",
          "label": "Talla"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Dog Size Quiz"
    }
  ]
}
{% endschema %}

{% style %}
.quiz-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  color: {{ section.settings.primary_color }};
}
.breed-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.breed-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}
.breed-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.breed-card.selected {
  border-color: {{ section.settings.primary_color }};
  background-color: {{ section.settings.secondary_color }};
}
.breed-image {
  width: 150px;
  height: 150px;
  object-fit: cover;
  border-radius: 50%;
  margin-bottom: 10px;
}
.weight-selector {
  display: none;
  margin-top: 20px;
}
.weight-selector.active {
  display: block;
}
.form-select {
  width: 100%;
  max-width: 300px;
  padding: 10px;
  border-radius: 4px;
  border: 1px solid #ddd;
  margin: 10px 0;
}
.result-section {
  display: none;
  margin-top: 20px;
  padding: 20px;
  background-color: {{ section.settings.secondary_color }};
  border-radius: 8px;
}
.result-section.active {
  display: block;
}
{% endstyle %}

<div class="quiz-container">
  <h2>{{ section.settings.title }}</h2>
  
  <div class="breed-grid" id="breedSelector">
    {% for block in section.blocks %}
      {% if block.type == 'dog_breed' %}
        <div class="breed-card" 
          data-breed="{{ block.settings.breed_name | handleize }}"
          data-block-id="{{ forloop.index0 }}">
          {% if block.settings.breed_image %}
            {{ block.settings.breed_image | image_url: width: 150 | image_tag: class: 'breed-image', alt: block.settings.breed_name }}
          {% endif %}
          <h3>{{ block.settings.breed_name }}</h3>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <div id="weightSelector" class="weight-selector">
    <h3>Selecciona el peso de tu perro</h3>
    <select id="weightRange" class="form-select">
      <option value="">Selecciona un rango de peso</option>
    </select>
  </div>

  <div id="resultSection" class="result-section">
    <h3>Talla recomendada</h3>
    <p>Para tu <span id="selectedBreed"></span> de <span id="selectedWeight"></span> kg, recomendamos la talla <span id="recommendedSize"></span>.</p>
    <p>Circunferencia de cuello: <span id="neckSize"></span> cm</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const breedCards = document.querySelectorAll('.breed-card');
  const weightSelector = document.getElementById('weightSelector');
  const weightRange = document.getElementById('weightRange');
  const resultSection = document.getElementById('resultSection');
  
  let selectedBreed = '';

  breedCards.forEach(card => {
    card.addEventListener('click', function() {
      document.querySelector('.breed-card.selected')?.classList.remove('selected');
      this.classList.add('selected');
      
      selectedBreed = this.dataset.breed;
      updateWeightRanges(this);
      
      weightSelector.classList.add('active');
      resultSection.classList.remove('active');
    });
  });

  weightRange.addEventListener('change', function() {
    if (this.value) {
      const [weight, neck, size] = this.value.split('|');
      
      document.getElementById('selectedBreed').textContent = selectedBreed.replace('-', ' ');
      document.getElementById('selectedWeight').textContent = weight;
      document.getElementById('recommendedSize').textContent = size;
      document.getElementById('neckSize').textContent = neck;
      
      resultSection.classList.add('active');
    }
  });

  function updateWeightRanges(breedCard) {
    weightRange.innerHTML = '<option value="">Selecciona un rango de peso</option>';
    
    const blockId = breedCard.dataset.blockId;
    const block = {{ section.blocks | json }}[blockId];
    
    for (let i = 1; i <= 5; i++) {
      const weightRange = block.settings[`weight_range_${i}`];
      const neckRange = block.settings[`neck_range_${i}`];
      const size = block.settings[`size_${i}`];
      
      if (weightRange && neckRange && size) {
        const option = document.createElement('option');
        option.value = `${weightRange}|${neckRange}|${size}`;
        option.textContent = `${weightRange} kg`;
        weightRange.appendChild(option);
      }
    }
  }
});
</script>
